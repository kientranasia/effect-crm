{% extends "base.html" %}

{% block title %}{{ contact.first_name }} {{ contact.last_name }} - Effect CRM{% endblock %}

{% block content %}
<div class="container-fluid px-4" style="padding-top: 24px !important;">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-2">Contacts</h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-0">
                    <li class="breadcrumb-item"><a href="{{ url_for('main.dashboard') }}" class="text-decoration-none">Dashboard</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for('contacts.index') }}" class="text-decoration-none">Contacts</a></li>
                    <li class="breadcrumb-item active" aria-current="page">{{ contact.first_name }} {{ contact.last_name }}</li>
                </ol>
            </nav>
        </div>
        <div class="d-flex gap-2">
            <a href="{{ url_for('contacts.edit', id=contact.id) }}" class="btn btn-primary">
                <i class="fas fa-edit me-2"></i>Edit Contact
            </a>
            <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal">
                <i class="fas fa-trash me-2"></i>Delete Contact
            </button>
        </div>
    </div>

    <!-- Contact Profile Header -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-body p-4">
            <div class="d-flex justify-content-between">
                <!-- Left: Contact Info -->
                <div class="d-flex gap-3">
                    <div class="avatar-circle bg-primary" style="width: 64px; height: 64px; font-size: 1.5rem;">
                        {{ contact.first_name[0] }}{{ contact.last_name[0] }}
                    </div>
                    <div>
                        <div class="d-flex align-items-center gap-2 mb-1">
                            <h2 class="h4 mb-0">{{ contact.first_name }} {{ contact.last_name }}</h2>
                            <span class="badge bg-success-subtle text-success">Active</span>
                        </div>
                        <div class="d-flex align-items-center gap-3 text-muted">
                            {% if contact.phone %}
                            <div class="d-flex align-items-center gap-2">
                                <i class="fas fa-phone"></i>
                                <a href="tel:{{ contact.phone }}" class="text-muted text-decoration-none">{{ contact.phone }}</a>
                            </div>
                            {% endif %}
                            {% if contact.email %}
                            <div class="d-flex align-items-center gap-2">
                                <i class="fas fa-envelope"></i>
                                <a href="mailto:{{ contact.email }}" class="text-muted text-decoration-none">{{ contact.email }}</a>
                            </div>
                            {% endif %}
                        </div>
                        <div class="text-muted mt-1">
                            {% if contact.job_title %}
                            <div class="d-flex align-items-center gap-2">
                                <i class="fas fa-briefcase"></i>
                                <span>{{ contact.job_title }}</span>
                                {% if contact.organization %}
                                <span class="mx-1">at</span>
                                <span>{{ contact.organization.name }}</span>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Right: Deal Information -->
                <div class="d-flex gap-4">
                    <div class="text-end">
                        <div class="small text-muted mb-1">Deal Value</div>
                        <div class="h5 mb-0 text-primary">
                            {% if contact.deal_value is not none %}
                                ${{ "%.2f"|format(contact.deal_value) }}
                            {% else %}
                                $0.00
                            {% endif %}
                        </div>
                    </div>
                    <div class="text-end">
                        <div class="small text-muted mb-1">Probability</div>
                        <div class="h5 mb-0 text-success">
                            {% if contact.probability is not none %}
                                {{ "%.1f"|format(contact.probability) }}%
                            {% else %}
                                0%
                            {% endif %}
                        </div>
                    </div>
                    <div class="text-end">
                        <div class="small text-muted mb-1">Pipeline Stage</div>
                        <div class="h5 mb-0 text-info">{{ contact.stage_display|default('New') }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <ul class="nav nav-tabs nav-tabs-custom mb-4">
        <li class="nav-item">
            <a class="nav-link active" data-bs-toggle="tab" href="#accounts">
                <i class="fas fa-user-circle me-2"></i>Accounts Overview
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#interactions">
                <i class="fas fa-comments me-2"></i>Interactions
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#attachments">
                <i class="fas fa-paperclip me-2"></i>Attachments
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#organization">
                <i class="fas fa-building me-2"></i>Organization
            </a>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content">
        <!-- Accounts Overview Tab -->
        <div class="tab-pane fade show active" id="accounts">
            <div class="row g-4">
                <!-- Left Column -->
                <div class="col-lg-8">
                    <!-- Account Information -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-transparent border-0">
                            <h5 class="card-title mb-0">Account Information</h5>
                        </div>
                        <div class="card-body">
                            <!-- Basic Information -->
                            <h6 class="text-muted mb-3">Basic Information</h6>
                            <div class="row g-3 mb-4">
                                <div class="col-md-6">
                                    <div class="mb-2">
                                        <label class="small text-muted">First Name</label>
                                        <div>{{ contact.first_name }}</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-2">
                                        <label class="small text-muted">Last Name</label>
                                        <div>{{ contact.last_name }}</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-2">
                                        <label class="small text-muted">Email</label>
                                        <div>
                                            {% if contact.email %}
                                            <a href="mailto:{{ contact.email }}" class="text-decoration-none">{{ contact.email }}</a>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-2">
                                        <label class="small text-muted">Phone</label>
                                        <div>
                                            {% if contact.phone %}
                                            <a href="tel:{{ contact.phone }}" class="text-decoration-none">{{ contact.phone }}</a>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <hr class="my-4">

                            <!-- Address Information -->
                            <h6 class="text-muted mb-3">Address Information</h6>
                            <div class="row g-4 mb-4">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="small text-muted">Address Line 1</label>
                                        <div>{{ contact.address_line1 }}</div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="small text-muted">Address Line 2</label>
                                        <div>{{ contact.address_line2 }}</div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="small text-muted">City</label>
                                        <div>{{ contact.city }}</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="small text-muted">State/Province</label>
                                        <div>{{ contact.state }}</div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="small text-muted">Country</label>
                                        <div>{{ contact.country }}</div>
                                    </div>
                                </div>
                            </div>
                            <hr class="my-4">

                            <!-- Professional Information -->
                            <h6 class="text-muted mb-3">Professional Information</h6>
                            <div class="row g-4 mb-4">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="small text-muted">Company Name</label>
                                        <div>{{ contact.company_name }}</div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="small text-muted">Job Title</label>
                                        <div>{{ contact.title }}</div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="small text-muted">Department</label>
                                        <div>{{ contact.department }}</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="small text-muted">Work Phone</label>
                                        <div>
                                            {% if contact.work_phone %}
                                            <a href="tel:{{ contact.work_phone }}" class="text-decoration-none">{{ contact.work_phone }}</a>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="small text-muted">Work Email</label>
                                        <div>
                                            {% if contact.alternate_email %}
                                            <a href="mailto:{{ contact.alternate_email }}" class="text-decoration-none">{{ contact.alternate_email }}</a>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="small text-muted">Industry</label>
                                        <div>{{ contact.industry }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="col-lg-4">
                    <!-- Organization Details -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-transparent border-0">
                            <h5 class="card-title mb-0">Organization Details</h5>
                        </div>
                        <div class="card-body">
                            {% if contact.organization %}
                            <div class="d-flex align-items-center gap-4 mb-4">
                                <div class="organization-logo rounded bg-light d-flex align-items-center justify-content-center" 
                                     style="width: 64px; height: 64px;">
                                    <i class="fas fa-building text-primary fa-2x"></i>
                                </div>
                                <div>
                                    <h4 class="mb-1">{{ contact.organization.name }}</h4>
                                    <span class="badge bg-light text-secondary">{{ contact.organization.industry }}</span>
                                </div>
                            </div>
                            <div class="row g-4">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="small text-muted">Website</label>
                                        <div>
                                            {% if contact.organization.website %}
                                            <a href="{{ contact.organization.website }}" target="_blank" class="text-decoration-none">
                                                {{ contact.organization.website }}
                                                <i class="fas fa-external-link-alt ms-1 small"></i>
                                            </a>
                                            {% else %}
                                            <span class="text-muted">Not provided</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="small text-muted">Phone</label>
                                        <div>{{ contact.organization.phone|default('Not provided', true) }}</div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="small text-muted">Email</label>
                                        <div>{{ contact.organization.email|default('Not provided', true) }}</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="small text-muted">Address</label>
                                        <div>{{ contact.organization.address|default('Not provided', true) }}</div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="small text-muted">Size</label>
                                        <div>{{ contact.organization.size|default('Not provided', true) }}</div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="small text-muted">Founded</label>
                                        <div>{{ contact.organization.founded|default('Not provided', true) }}</div>
                                    </div>
                                </div>
                            </div>
                            {% else %}
                            <div class="text-center py-5">
                                <div class="icon-circle bg-light text-muted mx-auto mb-3">
                                    <i class="fas fa-building"></i>
                                </div>
                                <h6 class="text-muted">No Organization Associated</h6>
                                <p class="text-muted small mb-3">This contact is not associated with any organization</p>
                                <button class="btn btn-light">
                                    <i class="fas fa-plus me-2"></i>Add Organization
                                </button>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Connections Management -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">Connections Management</h5>
                            <button class="btn btn-sm btn-light" data-bs-toggle="modal" data-bs-target="#addConnectionModal">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div class="card-body p-0">
                            <div class="list-group list-group-flush" id="connectionsList">
                                <!-- Connections will be loaded here -->
                            </div>
                            <div class="text-center py-4 d-none" id="noConnections">
                                <div class="icon-circle bg-light text-muted mx-auto mb-3">
                                    <i class="fas fa-user-friends"></i>
                                </div>
                                <h6 class="text-muted">No Connections</h6>
                                <p class="text-muted small mb-0">Add connections to link this contact with others</p>
                            </div>
                        </div>
                    </div>

                    <!-- Social Information -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-transparent border-0">
                            <h5 class="card-title mb-0">Social Information</h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-4">
                                <div class="col-12">
                                    <div class="d-flex flex-column gap-3">
                                        {% if contact.linkedin %}
                                        <div class="d-flex align-items-center">
                                            <div class="icon-circle bg-primary-subtle text-primary me-3" style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%;">
                                                <i class="fab fa-linkedin-in"></i>
                                            </div>
                                            <div>
                                                <label class="small text-muted d-block">LinkedIn</label>
                                                <a href="{{ contact.linkedin }}" target="_blank" class="text-decoration-none">{{ contact.linkedin }}</a>
                                            </div>
                                        </div>
                                        {% endif %}
                                        {% if contact.twitter %}
                                        <div class="d-flex align-items-center">
                                            <div class="icon-circle bg-info-subtle text-info me-3" style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%;">
                                                <i class="fab fa-twitter"></i>
                                            </div>
                                            <div>
                                                <label class="small text-muted d-block">Twitter</label>
                                                <a href="{{ contact.twitter }}" target="_blank" class="text-decoration-none">{{ contact.twitter }}</a>
                                            </div>
                                        </div>
                                        {% endif %}
                                        {% if contact.facebook %}
                                        <div class="d-flex align-items-center">
                                            <div class="icon-circle bg-primary-subtle text-primary me-3" style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%;">
                                                <i class="fab fa-facebook-f"></i>
                                            </div>
                                            <div>
                                                <label class="small text-muted d-block">Facebook</label>
                                                <a href="{{ contact.facebook }}" target="_blank" class="text-decoration-none">{{ contact.facebook }}</a>
                                            </div>
                                        </div>
                                        {% endif %}
                                        {% if contact.instagram %}
                                        <div class="d-flex align-items-center">
                                            <div class="icon-circle bg-danger-subtle text-danger me-3" style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%;">
                                                <i class="fab fa-instagram"></i>
                                            </div>
                                            <div>
                                                <label class="small text-muted d-block">Instagram</label>
                                                <a href="{{ contact.instagram }}" target="_blank" class="text-decoration-none">{{ contact.instagram }}</a>
                                            </div>
                                        </div>
                                        {% endif %}
                                        {% if contact.github %}
                                        <div class="d-flex align-items-center">
                                            <div class="icon-circle bg-dark-subtle text-dark me-3" style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%;">
                                                <i class="fab fa-github"></i>
                                            </div>
                                            <div>
                                                <label class="small text-muted d-block">GitHub</label>
                                                <a href="{{ contact.github }}" target="_blank" class="text-decoration-none">{{ contact.github }}</a>
                                            </div>
                                        </div>
                                        {% endif %}
                                        {% if not contact.linkedin and not contact.twitter and not contact.facebook and not contact.instagram and not contact.github %}
                                        <div class="text-center py-3">
                                            <div class="icon-circle bg-light text-muted mx-auto mb-3">
                                                <i class="fas fa-share-alt"></i>
                                            </div>
                                            <h6 class="text-muted">No Social Profiles</h6>
                                            <p class="text-muted small mb-0">No social media profiles have been added yet</p>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Related Tasks -->
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">Related Tasks</h5>
                            <a href="#" class="btn btn-sm btn-link text-decoration-none">View All</a>
                        </div>
                        <div class="card-body p-0">
                            <div class="list-group list-group-flush">
                                <div class="list-group-item d-flex align-items-center gap-3 px-4 py-3">
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input">
                                    </div>
                                    <div class="flex-grow-1">
                                        <h6 class="mb-0">Follow up on investment inquiry</h6>
                                        <small class="text-danger">Overdue</small>
                                    </div>
                                    <button class="btn btn-sm btn-light">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                                <div class="list-group-item d-flex align-items-center gap-3 px-4 py-3">
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input" checked>
                                    </div>
                                    <div class="flex-grow-1">
                                        <h6 class="mb-0">Send welcome package</h6>
                                        <small class="text-success">Completed</small>
                                    </div>
                                    <button class="btn btn-sm btn-light">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="p-4">
                                <button class="btn btn-light w-100">
                                    <i class="fas fa-plus me-2"></i>Add new task
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Contact Details -->
                    <div class="card border-0 shadow-sm mt-3">
                        <div class="card-header bg-transparent border-0">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-info-circle text-primary me-2"></i>Contact Details
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="timeline">
                                <div class="timeline-item mb-3">
                                    <div class="d-flex align-items-center text-muted mb-1">
                                        <i class="fas fa-plus-circle me-2"></i>Created
                                    </div>
                                    <div class="ps-4">
                                        {{ contact.created_at.strftime('%B %d, %Y') }}
                                        <div class="text-primary">by {{ contact.created_by.full_name }}</div>
                                    </div>
                                </div>
                                <div class="timeline-item mb-3">
                                    <div class="d-flex align-items-center text-muted mb-1">
                                        <i class="fas fa-edit me-2"></i>Last Updated
                                    </div>
                                    <div class="ps-4">
                                        {{ contact.updated_at.strftime('%B %d, %Y') }}
                                        <div class="text-primary">{{ contact.updated_at.strftime('%I:%M %p') }}</div>
                                    </div>
                                </div>
                                <div class="timeline-item">
                                    <div class="d-flex align-items-center text-muted mb-1">
                                        <i class="fas fa-user-circle me-2"></i>Created By
                                    </div>
                                    <div class="ps-4">
                                        {{ contact.created_by.full_name }}
                                        <div class="text-primary">Primary Contact Owner</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Interactions Tab -->
        <div class="tab-pane fade" id="interactions">
            <div class="row g-4">
                <div class="col-12">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">Interaction History</h5>
                            <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#newInteractionModal">
                                <i class="fas fa-plus me-2"></i>New Interaction
                            </button>
                        </div>
                        <div class="card-body p-0">
                            <div class="list-group list-group-flush">
                                {% for interaction in contact.interactions %}
                                <div class="list-group-item px-4 py-3">
                                    <div class="d-flex align-items-start gap-3">
                                        <div class="icon-circle {% if interaction.type == 'call' %}bg-primary-subtle text-primary{% elif interaction.type == 'meeting' %}bg-success-subtle text-success{% elif interaction.type == 'email' %}bg-info-subtle text-info{% else %}bg-warning-subtle text-warning{% endif %}">
                                            <i class="fas {% if interaction.type == 'call' %}fa-phone{% elif interaction.type == 'meeting' %}fa-handshake{% elif interaction.type == 'email' %}fa-envelope{% else %}fa-tasks{% endif %}"></i>
                                        </div>
                                        <div class="flex-grow-1">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <h6 class="mb-0">{{ interaction.title }}</h6>
                                                <span class="badge {% if interaction.status == 'completed' %}bg-success-subtle text-success{% elif interaction.status == 'pending' %}bg-warning-subtle text-warning{% else %}bg-danger-subtle text-danger{% endif %}">
                                                    {{ interaction.status|title }}
                                                </span>
                                            </div>
                                            <p class="text-muted small mb-2">{{ interaction.description }}</p>
                                            <div class="d-flex align-items-center gap-3 small text-muted">
                                                <span><i class="far fa-clock me-1"></i>{{ interaction.created_at.strftime('%B %d, %Y at %I:%M %p') }}</span>
                                                <span><i class="far fa-user me-1"></i>{{ interaction.created_by.full_name }}</span>
                                            </div>
                                        </div>
                                        <div class="dropdown">
                                            <button class="btn btn-sm btn-light" data-bs-toggle="dropdown">
                                                <i class="fas fa-ellipsis-h"></i>
                                            </button>
                                            <ul class="dropdown-menu dropdown-menu-end">
                                                <li><a class="dropdown-item" href="#"><i class="fas fa-edit me-2"></i>Edit</a></li>
                                                <li><a class="dropdown-item" href="#"><i class="fas fa-eye me-2"></i>View Details</a></li>
                                                <li><hr class="dropdown-divider"></li>
                                                <li><a class="dropdown-item text-danger" href="#"><i class="fas fa-trash me-2"></i>Delete</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                {% else %}
                                <div class="text-center py-5">
                                    <div class="icon-circle bg-light text-muted mx-auto mb-3">
                                        <i class="fas fa-comments"></i>
                                    </div>
                                    <h6 class="text-muted">No interactions yet</h6>
                                    <p class="text-muted small mb-0">Create your first interaction with this contact</p>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Attachments Tab -->
        <div class="tab-pane fade" id="attachments">
            <div class="row g-4">
                <div class="col-12">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">Attached Files</h5>
                            <button class="btn btn-primary btn-sm">
                                <i class="fas fa-upload me-2"></i>Upload File
                            </button>
                        </div>
                        <div class="card-body p-0">
                            <div class="list-group list-group-flush">
                                {% for file in contact.files %}
                                <div class="list-group-item px-4 py-3">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="icon-circle bg-light text-muted">
                                            <i class="fas {% if file.type == 'pdf' %}fa-file-pdf{% elif file.type == 'doc' %}fa-file-word{% elif file.type == 'image' %}fa-file-image{% else %}fa-file{% endif %}"></i>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="mb-0">{{ file.name }}</h6>
                                            <small class="text-muted">{{ file.size }} • {{ file.uploaded_at.strftime('%B %d, %Y') }}</small>
                                        </div>
                                        <div class="d-flex gap-2">
                                            <button class="btn btn-sm btn-light" title="Download">
                                                <i class="fas fa-download"></i>
                                            </button>
                                            <button class="btn btn-sm btn-light" title="Delete">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                {% else %}
                                <div class="text-center py-5">
                                    <div class="icon-circle bg-light text-muted mx-auto mb-3">
                                        <i class="fas fa-file"></i>
                                    </div>
                                    <h6 class="text-muted">No files attached</h6>
                                    <p class="text-muted small mb-0">Upload files to share with this contact</p>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Organization Tab -->
        <div class="tab-pane fade" id="organization">
            <div class="row g-4">
                <div class="col-12">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-transparent border-0">
                            <h5 class="card-title mb-0">Organization Details</h5>
                        </div>
                        <div class="card-body">
                            {% if contact.organization %}
                            <div class="d-flex align-items-center gap-4 mb-4">
                                <div class="organization-logo rounded bg-light d-flex align-items-center justify-content-center" 
                                     style="width: 64px; height: 64px;">
                                    <i class="fas fa-building text-primary fa-2x"></i>
                                </div>
                                <div>
                                    <h4 class="mb-1">{{ contact.organization.name }}</h4>
                                    <span class="badge bg-light text-secondary">{{ contact.organization.industry }}</span>
                                </div>
                            </div>
                            <div class="row g-4">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="small text-muted">Website</label>
                                        <div>
                                            {% if contact.organization.website %}
                                            <a href="{{ contact.organization.website }}" target="_blank" class="text-decoration-none">
                                                {{ contact.organization.website }}
                                                <i class="fas fa-external-link-alt ms-1 small"></i>
                                            </a>
                                            {% else %}
                                            <span class="text-muted">Not provided</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="small text-muted">Phone</label>
                                        <div>{{ contact.organization.phone|default('Not provided', true) }}</div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="small text-muted">Email</label>
                                        <div>{{ contact.organization.email|default('Not provided', true) }}</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="small text-muted">Address</label>
                                        <div>{{ contact.organization.address|default('Not provided', true) }}</div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="small text-muted">Size</label>
                                        <div>{{ contact.organization.size|default('Not provided', true) }}</div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="small text-muted">Founded</label>
                                        <div>{{ contact.organization.founded|default('Not provided', true) }}</div>
                                    </div>
                                </div>
                            </div>
                            {% else %}
                            <div class="text-center py-5">
                                <div class="icon-circle bg-light text-muted mx-auto mb-3">
                                    <i class="fas fa-building"></i>
                                </div>
                                <h6 class="text-muted">No Organization Associated</h6>
                                <p class="text-muted small mb-3">This contact is not associated with any organization</p>
                                <button class="btn btn-light">
                                    <i class="fas fa-plus me-2"></i>Add Organization
                                </button>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- New Interaction Modal -->
    <div class="modal fade" id="newInteractionModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0">
                <div class="modal-header border-0">
                    <h5 class="modal-title">New Interaction</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-3">
                            <label class="form-label">Type</label>
                            <select class="form-select">
                                <option value="call">Call</option>
                                <option value="meeting">Meeting</option>
                                <option value="email">Email</option>
                                <option value="task">Task</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Title</label>
                            <input type="text" class="form-control" placeholder="Enter title">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" rows="3" placeholder="Enter description"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Date & Time</label>
                            <input type="datetime-local" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Status</label>
                            <select class="form-select">
                                <option value="pending">Pending</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary">Create Interaction</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0">
            <div class="modal-body text-center p-4">
                <div class="icon-circle bg-danger-subtle text-danger mx-auto mb-4" style="width: 48px; height: 48px;">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h5 class="modal-title mb-3">Delete Contact</h5>
                <p class="text-muted mb-4">Are you sure you want to delete this contact? This action cannot be undone.</p>
                <div class="d-flex gap-2 justify-content-center">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <form action="{{ url_for('contacts.delete', id=contact.id) }}" method="POST">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="btn btn-danger">Delete Contact</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Import vCard Modal -->
<div class="modal fade" id="importVCardModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0">
            <div class="modal-header border-0">
                <h5 class="modal-title">Import vCard Contacts</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="vCardImportForm" action="{{ url_for('contacts.import_vcard') }}" method="POST" enctype="multipart/form-data">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    
                    <!-- File Upload -->
                    <div class="mb-4">
                        <div class="upload-zone p-4 text-center border rounded-3" id="dropZone">
                            <i class="fas fa-file-upload fa-2x text-muted mb-3"></i>
                            <h6>Drag & Drop vCard Files</h6>
                            <p class="text-muted small mb-3">or</p>
                            <label class="btn btn-light">
                                <input type="file" name="vcard_files" multiple accept=".vcf,text/vcard" class="d-none" id="vCardInput">
                                Browse Files
                            </label>
                            <div class="text-muted small mt-2">Supports .vcf files</div>
                        </div>
                    </div>

                    <!-- Selected Files List -->
                    <div id="selectedFiles" class="mb-4 d-none">
                        <h6 class="mb-3">Selected Files</h6>
                        <div class="selected-files-list">
                            <!-- Files will be listed here via JavaScript -->
                        </div>
                    </div>

                    <!-- Import Options -->
                    <div class="mb-4">
                        <h6 class="mb-3">Import Options</h6>
                        <div class="form-check mb-2">
                            <input type="checkbox" class="form-check-input" id="skipDuplicates" name="skip_duplicates" checked>
                            <label class="form-check-label" for="skipDuplicates">Skip duplicate contacts</label>
                        </div>
                        <div class="form-check mb-2">
                            <input type="checkbox" class="form-check-input" id="updateExisting" name="update_existing">
                            <label class="form-check-label" for="updateExisting">Update existing contacts</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="importPhotos" name="import_photos" checked>
                            <label class="form-check-label" for="importPhotos">Import contact photos</label>
                        </div>
                    </div>

                    <!-- Progress Bar (Hidden by default) -->
                    <div class="progress d-none mb-3" id="importProgress">
                        <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="startImport">
                    <i class="fas fa-file-import me-2"></i>Start Import
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Add Connection Modal -->
<div class="modal fade" id="addConnectionModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0">
            <div class="modal-header border-0">
                <h5 class="modal-title">Add Connection</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addConnectionForm">
                    <div class="mb-4">
                        <label class="form-label">Search Contact</label>
                        <div class="input-group mb-2">
                            <input type="text" class="form-control" id="contactSearch" 
                                   placeholder="Search by name, email, or phone number..."
                                   autocomplete="off">
                            <button class="btn btn-outline-secondary" type="button" id="searchContact">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                        <div class="form-text">
                            Search by: full name, email, phone, work phone, or home phone
                        </div>
                    </div>

                    <!-- Contact List -->
                    <div class="mb-4">
                        <div class="contact-list border rounded-3 overflow-auto" style="max-height: 300px;">
                            <div id="contactListContainer" class="list-group list-group-flush">
                                <!-- Contacts will be loaded here -->
                            </div>
                            <div id="noContactsFound" class="text-center py-4 d-none">
                                <div class="text-muted">No contacts found</div>
                                <small class="text-muted d-block mt-2">Try different search terms</small>
                            </div>
                            <div id="loadingContacts" class="text-center py-4">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Selected Contact Info -->
                    <div id="selectedContactInfo" class="mb-4 d-none">
                        <div class="d-flex align-items-center p-3 bg-light rounded-3">
                            <div class="avatar-circle bg-primary me-3">
                                <span class="contact-initials"></span>
                            </div>
                            <div>
                                <h6 class="mb-1 selected-contact-name"></h6>
                                <div class="text-muted small selected-contact-details"></div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="form-label">Relationship Type</label>
                        <select class="form-select" id="relationshipType" required>
                            <option value="Friend">Friend</option>
                            <option value="Colleague">Colleague</option>
                            <option value="Family">Family</option>
                            <option value="Client">Client</option>
                            <option value="Partner">Partner</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <div class="mb-4">
                        <label class="form-label">Notes</label>
                        <textarea class="form-control" id="connectionNotes" rows="3" placeholder="Add any notes about this connection..."></textarea>
                    </div>

                    <input type="hidden" id="selectedContactId" value="">
                </form>
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveConnection">Add Connection</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Connection Modal -->
<div class="modal fade" id="editConnectionModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0">
            <div class="modal-header border-0">
                <h5 class="modal-title">Edit Connection</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="editConnectionForm">
                    <div class="mb-4">
                        <label class="form-label">Relationship Type</label>
                        <select class="form-select" id="editRelationshipType" required>
                            <option value="Friend">Friend</option>
                            <option value="Colleague">Colleague</option>
                            <option value="Family">Family</option>
                            <option value="Client">Client</option>
                            <option value="Partner">Partner</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <div class="mb-4">
                        <label class="form-label">Notes</label>
                        <textarea class="form-control" id="editConnectionNotes" rows="3" placeholder="Add any notes about this connection..."></textarea>
                    </div>

                    <input type="hidden" id="editConnectionId" value="">
                </form>
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveConnectionEdit">Save Changes</button>
            </div>
        </div>
    </div>
</div>

<style>
.contact-list {
    border: 1px solid #dee2e6;
}

.contact-list .list-group-item {
    cursor: pointer;
    transition: background-color 0.2s;
}

.contact-list .list-group-item:hover {
    background-color: #f8f9fa;
}

.contact-list .list-group-item.selected {
    background-color: #e9ecef;
}

.avatar-circle {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 500;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const contactId = {{ contact.id }};
    const connectionsList = document.getElementById('connectionsList');
    const noConnections = document.getElementById('noConnections');
    const addConnectionModal = new bootstrap.Modal(document.getElementById('addConnectionModal'));
    const editConnectionModal = new bootstrap.Modal(document.getElementById('editConnectionModal'));
    const contactSearch = document.getElementById('contactSearch');
    const searchContactBtn = document.getElementById('searchContact');
    const contactListContainer = document.getElementById('contactListContainer');
    const noContactsFound = document.getElementById('noContactsFound');
    const loadingContacts = document.getElementById('loadingContacts');
    const selectedContactInfo = document.getElementById('selectedContactInfo');
    const selectedContactId = document.getElementById('selectedContactId');
    
    // Load connections
    function loadConnections() {
        fetch(`/contacts/${contactId}/connections`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                connectionsList.innerHTML = '';
                if (!data.connections || data.connections.length === 0) {
                    noConnections.classList.remove('d-none');
                    return;
                }
                noConnections.classList.add('d-none');
                data.connections.forEach(conn => {
                    const connectionItem = document.createElement('div');
                    connectionItem.className = 'list-group-item d-flex align-items-center gap-3 px-4 py-3';
                    connectionItem.innerHTML = `
                        <div class="avatar-circle bg-primary">${conn.other_contact.avatar}</div>
                        <div class="flex-grow-1">
                            <a href="/contacts/${conn.other_contact.id}" class="text-decoration-none">
                                <h6 class="mb-0">${conn.other_contact.name}</h6>
                            </a>
                            <small class="text-muted">${conn.relationship_type}</small>
                            ${conn.notes ? `<small class="text-muted d-block">${conn.notes}</small>` : ''}
                        </div>
                        <div class="d-flex gap-2">
                            <button class="btn btn-sm btn-light edit-connection" data-id="${conn.id}" 
                                    data-relationship="${conn.relationship_type}" 
                                    data-notes="${conn.notes || ''}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-light delete-connection" data-id="${conn.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    connectionsList.appendChild(connectionItem);
                });
            })
            .catch(error => {
                console.error('Error loading connections:', error);
                noConnections.classList.remove('d-none');
            });
    }
    
    // Load all contacts
    function loadContacts() {
        loadingContacts.classList.remove('d-none');
        noContactsFound.classList.add('d-none');
        contactListContainer.innerHTML = '';
        
        fetch('/contacts/search')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                displayContacts(data.contacts || []);
            })
            .catch(error => {
                console.error('Error loading contacts:', error);
                noContactsFound.classList.remove('d-none');
            })
            .finally(() => {
                loadingContacts.classList.add('d-none');
            });
    }
    
    // Search contacts
    function searchContacts(query) {
        loadingContacts.classList.remove('d-none');
        noContactsFound.classList.add('d-none');
        contactListContainer.innerHTML = '';
        
        fetch(`/contacts/search?query=${encodeURIComponent(query)}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                displayContacts(data.contacts || []);
            })
            .catch(error => {
                console.error('Error searching contacts:', error);
                noContactsFound.classList.remove('d-none');
            })
            .finally(() => {
                loadingContacts.classList.add('d-none');
            });
    }
    
    // Display contacts
    function displayContacts(contacts) {
        contactListContainer.innerHTML = '';
        loadingContacts.classList.add('d-none');
        
        if (!contacts || contacts.length === 0) {
            noContactsFound.classList.remove('d-none');
            return;
        }
        
        noContactsFound.classList.add('d-none');

        // Get existing connections
        fetch(`/contacts/${contactId}/connections`)
            .then(response => response.json())
            .then(data => {
                const connectedIds = data.connections.map(conn => 
                    conn.other_contact.id
                );

                contacts.forEach(contact => {
                    if (contact.id !== contactId && !connectedIds.includes(contact.id)) {
                        const item = document.createElement('div');
                        item.className = 'list-group-item d-flex align-items-center py-3 px-4';
                        
                        const phones = [
                            { type: '', number: contact.phone },
                            { type: 'Work', number: contact.work_phone },
                            { type: 'Home', number: contact.home_phone }
                        ].filter(p => p.number)
                         .map(p => p.type ? `${p.type}: ${p.number}` : p.number)
                         .join(' • ');
                        
                        const email = contact.email;
                        
                        item.innerHTML = `
                            <div class="avatar-circle bg-primary me-3">
                                <span>${contact.first_name[0]}${contact.last_name[0]}</span>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1">${contact.first_name} ${contact.last_name}</h6>
                                <div class="text-muted small">
                                    ${phones ? `<div><i class="fas fa-phone me-1"></i>${phones}</div>` : ''}
                                    ${email ? `<div><i class="fas fa-envelope me-1"></i>${email}</div>` : ''}
                                </div>
                            </div>
                        `;
                        
                        item.addEventListener('click', () => selectContact(contact, item));
                        contactListContainer.appendChild(item);
                    }
                });
            });
    }
    
    // Select a contact
    function selectContact(contact, element) {
        // Remove selection from other items
        contactListContainer.querySelectorAll('.list-group-item').forEach(item => {
            item.classList.remove('selected');
        });
        
        // Add selection to clicked item
        element.classList.add('selected');
        
        // Update selected contact info
        selectedContactId.value = contact.id;
        selectedContactInfo.classList.remove('d-none');
        selectedContactInfo.querySelector('.contact-initials').textContent = `${contact.first_name[0]}${contact.last_name[0]}`;
        selectedContactInfo.querySelector('.selected-contact-name').textContent = `${contact.first_name} ${contact.last_name}`;
        
        const phones = [
            { type: '', number: contact.phone },
            { type: 'Work', number: contact.work_phone },
            { type: 'Home', number: contact.home_phone }
        ].filter(p => p.number)
         .map(p => p.type ? `${p.type}: ${p.number}` : p.number)
         .join(' • ');
        
        const details = [
            phones ? `<div><i class="fas fa-phone me-1"></i>${phones}</div>` : '',
            contact.email ? `<div><i class="fas fa-envelope me-1"></i>${contact.email}</div>` : ''
        ].filter(Boolean).join('');
        
        selectedContactInfo.querySelector('.selected-contact-details').innerHTML = details || 'No contact information';
    }

    // Unselect contact
    function unselectContact() {
        contactListContainer.querySelectorAll('.list-group-item').forEach(item => {
            item.classList.remove('selected');
        });
        selectedContactId.value = '';
        selectedContactInfo.classList.add('d-none');
    }

    // Add unselect button to selected contact info
    selectedContactInfo.querySelector('.d-flex').insertAdjacentHTML('beforeend', `
        <button type="button" class="btn btn-sm btn-light ms-auto" id="unselectContact">
            <i class="fas fa-times"></i>
        </button>
    `);

    document.getElementById('unselectContact').addEventListener('click', (e) => {
        e.preventDefault();
        unselectContact();
    });
    
    // Search button click handler
    searchContactBtn.addEventListener('click', () => {
        const query = contactSearch.value.trim();
        if (query) {
            searchContacts(query);
        } else {
            loadContacts();
        }
    });
    
    // Search input handlers
    contactSearch.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            e.preventDefault();
            searchContactBtn.click();
        }
    });
    
    contactSearch.addEventListener('input', () => {
        if (!contactSearch.value.trim()) {
            loadContacts();
        }
    });
    
    // Add connection
    document.getElementById('saveConnection').addEventListener('click', () => {
        const targetContactId = selectedContactId.value;
        const relationshipType = document.getElementById('relationshipType').value;
        const notes = document.getElementById('connectionNotes').value;
        
        if (!targetContactId) {
            alert('Please select a contact');
            return;
        }
        
        fetch(`/contacts/${contactId}/connections`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token() }}'
            },
            body: JSON.stringify({
                target_contact_id: targetContactId,
                relationship_type: relationshipType,
                notes: notes
            })
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            if (data.error) {
                throw new Error(data.error);
            }
            addConnectionModal.hide();
            loadConnections();
            // Reset form
            document.getElementById('addConnectionForm').reset();
            selectedContactInfo.classList.add('d-none');
            selectedContactId.value = '';
            contactListContainer.querySelectorAll('.list-group-item').forEach(item => {
                item.classList.remove('selected');
            });
        })
        .catch(error => {
            console.error('Error adding connection:', error);
            alert('Failed to add connection: ' + error.message);
        });
    });
    
    // Edit connection
    connectionsList.addEventListener('click', (e) => {
        if (e.target.closest('.edit-connection')) {
            const button = e.target.closest('.edit-connection');
            const connectionId = button.dataset.id;
            const relationshipType = button.dataset.relationship;
            const notes = button.dataset.notes;

            document.getElementById('editConnectionId').value = connectionId;
            document.getElementById('editRelationshipType').value = relationshipType;
            document.getElementById('editConnectionNotes').value = notes;

            editConnectionModal.show();
        }
    });

    // Save connection edit
    document.getElementById('saveConnectionEdit').addEventListener('click', () => {
        const connectionId = document.getElementById('editConnectionId').value;
        const relationshipType = document.getElementById('editRelationshipType').value;
        const notes = document.getElementById('editConnectionNotes').value;

        fetch(`/contacts/connections/${connectionId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token() }}'
            },
            body: JSON.stringify({
                relationship_type: relationshipType,
                notes: notes
            })
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            if (data.error) {
                throw new Error(data.error);
            }
            editConnectionModal.hide();
            loadConnections();
        })
        .catch(error => {
            console.error('Error updating connection:', error);
            alert('Failed to update connection: ' + error.message);
        });
    });
    
    // Delete connection
    connectionsList.addEventListener('click', (e) => {
        if (e.target.closest('.delete-connection')) {
            const connectionId = e.target.closest('.delete-connection').dataset.id;
            if (confirm('Are you sure you want to delete this connection?')) {
                fetch(`/contacts/connections/${connectionId}`, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': '{{ csrf_token() }}'
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.error) {
                        throw new Error(data.error);
                    }
                    loadConnections();
                })
                .catch(error => {
                    console.error('Error deleting connection:', error);
                    alert('Failed to delete connection: ' + error.message);
                });
            }
        }
    });
    
    // Load contacts when modal is shown
    document.getElementById('addConnectionModal').addEventListener('show.bs.modal', () => {
        loadContacts();
        // Reset form
        document.getElementById('addConnectionForm').reset();
        selectedContactInfo.classList.add('d-none');
        selectedContactId.value = '';
    });
    
    // Initial load of connections
    loadConnections();
});
</script>

{% endblock %} 