{% extends "base.html" %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-0">{% if contact %}Edit Contact{% else %}New Contact{% endif %}</h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('contacts.index') }}">Contacts</a></li>
                    <li class="breadcrumb-item active">{% if contact %}Edit Contact{% else %}New Contact{% endif %}</li>
                </ol>
            </nav>
        </div>
        <div class="d-flex gap-2">
            <button type="submit" form="contactForm" class="btn btn-primary">
                <i class="fas fa-save me-2"></i>Save Contact
            </button>
            <a href="{{ url_for('contacts.index') }}" class="btn btn-outline-secondary">
                <i class="fas fa-times me-2"></i>Cancel
            </a>
        </div>
    </div>

    <!-- Form -->
    <form id="contactForm" method="POST" class="needs-validation" novalidate>
        {{ form.csrf_token }}
        
        <div class="row g-4">
            <!-- Left Column - Main Form -->
            <div class="col-lg-8">
                <!-- Tabs Navigation -->
                <ul class="nav nav-tabs nav-tabs-modern mb-4" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#basic-info" type="button">
                            <i class="fas fa-user me-2"></i>Basic Info
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#contact-details" type="button">
                            <i class="fas fa-address-card me-2"></i>Contact Details
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#professional-info" type="button">
                            <i class="fas fa-briefcase me-2"></i>Professional
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#pipeline-info" type="button">
                            <i class="fas fa-project-diagram me-2"></i>Pipeline
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#social-info" type="button">
                            <i class="fas fa-share-alt me-2"></i>Social
                        </button>
                    </li>
                </ul>

                <!-- Tabs Content -->
                <div class="tab-content">
                    <!-- Basic Info Tab -->
                    <div class="tab-pane fade show active" id="basic-info">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <div class="row g-3">
                                    <!-- Personal Information -->
                                    <div class="col-md-6">
                                        {{ form.first_name.label(class="form-label required") }}
                                        {{ form.first_name(class="form-control", placeholder="Enter first name") }}
                                    </div>
                                    <div class="col-md-6">
                                        {{ form.last_name.label(class="form-label required") }}
                                        {{ form.last_name(class="form-control", placeholder="Enter last name") }}
                                    </div>
                                    <div class="col-md-6">
                                        {{ form.email.label(class="form-label required") }}
                                        {{ form.email(class="form-control", placeholder="Enter email") }}
                                    </div>
                                    <div class="col-md-6">
                                        {{ form.alternate_email.label(class="form-label") }}
                                        {{ form.alternate_email(class="form-control", placeholder="Enter alternate email") }}
                                    </div>
                                    <div class="col-12">
                                        <h6 class="text-muted mb-3">Phone Numbers</h6>
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                {{ form.phone.label(class="form-label") }}
                                                {{ form.phone(class="form-control", placeholder="Enter primary phone") }}
                                            </div>
                                            <div class="col-md-6">
                                                {{ form.mobile.label(class="form-label") }}
                                                {{ form.mobile(class="form-control", placeholder="Enter mobile phone") }}
                                            </div>
                                            <div class="col-md-6">
                                                {{ form.work_phone.label(class="form-label") }}
                                                {{ form.work_phone(class="form-control", placeholder="Enter work phone") }}
                                            </div>
                                            <div class="col-md-6">
                                                {{ form.home_phone.label(class="form-label") }}
                                                {{ form.home_phone(class="form-control", placeholder="Enter home phone") }}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        {{ form.title.label(class="form-label") }}
                                        {{ form.title(class="form-control", placeholder="Enter job title") }}
                                    </div>
                                    <div class="col-md-6">
                                        {{ form.department.label(class="form-label") }}
                                        {{ form.department(class="form-control", placeholder="Enter department") }}
                                    </div>
                                    <div class="col-md-6">
                                        {{ form.company_name.label(class="form-label") }}
                                        {{ form.company_name(class="form-control", placeholder="Enter company name") }}
                                    </div>
                                    <div class="col-md-6">
                                        {{ form.company_size.label(class="form-label") }}
                                        {{ form.company_size(class="form-select") }}
                                    </div>
                                    <div class="col-md-6">
                                        {{ form.industry.label(class="form-label") }}
                                        {{ form.industry(class="form-select") }}
                                    </div>
                                    <div class="col-md-6">
                                        {{ form.website.label(class="form-label") }}
                                        {{ form.website(class="form-control", placeholder="Enter website") }}
                                    </div>
                                    <div class="col-12">
                                        {{ form.bio.label(class="form-label") }}
                                        {{ form.bio(class="form-control", rows="4", placeholder="Enter professional bio") }}
                                    </div>
                                    <div class="col-12">
                                        {{ form.skills.label(class="form-label") }}
                                        {{ form.skills(class="form-control", placeholder="Enter skills (comma-separated)") }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Contact Details Tab -->
                    <div class="tab-pane fade" id="contact-details">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <!-- Contact Information -->
                                <h6 class="card-subtitle mb-3">Contact Information</h6>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        {{ form.address_line1.label(class="form-label") }}
                                        {{ form.address_line1(class="form-control", placeholder="Enter street address") }}
                                    </div>
                                    <div class="col-md-6">
                                        {{ form.address_line2.label(class="form-label") }}
                                        {{ form.address_line2(class="form-control", placeholder="Apartment, suite, unit, etc.") }}
                                    </div>
                                    <div class="col-md-6">
                                        {{ form.city.label(class="form-label") }}
                                        {{ form.city(class="form-control", placeholder="Enter city") }}
                                    </div>
                                    <div class="col-md-6">
                                        {{ form.state.label(class="form-label") }}
                                        {{ form.state(class="form-control", placeholder="Enter state/province") }}
                                    </div>
                                    <div class="col-md-6">
                                        {{ form.postal_code.label(class="form-label") }}
                                        {{ form.postal_code(class="form-control", placeholder="Enter postal code") }}
                                    </div>
                                    <div class="col-md-6">
                                        {{ form.country.label(class="form-label") }}
                                        {{ form.country(class="form-select") }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Professional Info Tab -->
                    <div class="tab-pane fade" id="professional-info">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        {{ form.stage.label(class="form-label") }}
                                        {{ form.stage(class="form-select") }}
                                    </div>
                                    <div class="col-md-6">
                                        {{ form.probability.label(class="form-label") }}
                                        {{ form.probability(class="form-control", type="number", min="0", max="100", step="1") }}
                                    </div>
                                    <div class="col-md-6">
                                        {{ form.deal_value.label(class="form-label") }}
                                        {{ form.deal_value(class="form-control", type="number", step="0.01") }}
                                    </div>
                                    <div class="col-md-6">
                                        {{ form.source.label(class="form-label") }}
                                        {{ form.source(class="form-select") }}
                                    </div>
                                    <div class="col-md-6">
                                        {{ form.source_channel.label(class="form-label") }}
                                        {{ form.source_channel(class="form-control", placeholder="Enter source channel") }}
                                    </div>
                                    <div class="col-12">
                                        {{ form.requirements.label(class="form-label") }}
                                        {{ form.requirements(class="form-control", rows="4", placeholder="Enter requirements") }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pipeline Info Tab -->
                    <div class="tab-pane fade" id="pipeline-info">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        {{ form.stage.label(class="form-label") }}
                                        {{ form.stage(class="form-select") }}
                                    </div>
                                    <div class="col-md-6">
                                        {{ form.probability.label(class="form-label") }}
                                        {{ form.probability(class="form-control", type="number", min="0", max="100", step="1") }}
                                    </div>
                                    <div class="col-md-6">
                                        {{ form.deal_value.label(class="form-label") }}
                                        {{ form.deal_value(class="form-control", type="number", step="0.01") }}
                                    </div>
                                    <div class="col-md-6">
                                        {{ form.source.label(class="form-label") }}
                                        {{ form.source(class="form-select") }}
                                    </div>
                                    <div class="col-md-6">
                                        {{ form.source_channel.label(class="form-label") }}
                                        {{ form.source_channel(class="form-control", placeholder="Enter source channel") }}
                                    </div>
                                    <div class="col-12">
                                        {{ form.requirements.label(class="form-label") }}
                                        {{ form.requirements(class="form-control", rows="4", placeholder="Enter requirements") }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Social Info Tab -->
                    <div class="tab-pane fade" id="social-info">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <!-- Social Media -->
                                <h6 class="card-subtitle mb-3">Social Media Profiles</h6>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fab fa-linkedin text-primary"></i></span>
                                            {{ form.linkedin(class="form-control", placeholder="LinkedIn profile URL") }}
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fab fa-twitter text-info"></i></span>
                                            {{ form.twitter(class="form-control", placeholder="Twitter profile URL") }}
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fab fa-facebook text-primary"></i></span>
                                            {{ form.facebook(class="form-control", placeholder="Facebook profile URL") }}
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fab fa-instagram text-danger"></i></span>
                                            {{ form.instagram(class="form-control", placeholder="Instagram profile URL") }}
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fab fa-github text-dark"></i></span>
                                            {{ form.github(class="form-control", placeholder="GitHub profile URL") }}
                                        </div>
                                    </div>
                                </div>

                                <!-- Additional Information -->
                                <h6 class="card-subtitle mb-3 mt-4">Additional Information</h6>
                                <div class="row g-3">
                                    <div class="col-12">
                                        {{ form.notes.label(class="form-label") }}
                                        {{ form.notes(class="form-control", rows="4", placeholder="Enter notes") }}
                                    </div>
                                    <div class="col-12">
                                        {{ form.interests.label(class="form-label") }}
                                        {{ form.interests(class="form-control", placeholder="Enter interests (comma-separated)") }}
                                    </div>
                                    <div class="col-12">
                                        {{ form.tags.label(class="form-label") }}
                                        {{ form.tags(class="form-control", placeholder="Enter tags (comma-separated)") }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column - Sidebar -->
            <div class="col-lg-4">
                <!-- Organization Card -->
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-transparent">
                        <h6 class="card-title mb-0">
                            <i class="fas fa-building me-2"></i>Organization
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            {{ form.organization_id.label(class="form-label") }}
                            {{ form.organization_id(class="form-select") }}
                        </div>
                        <button type="button" class="btn btn-outline-primary w-100" data-bs-toggle="modal" data-bs-target="#newOrgModal">
                            <i class="fas fa-plus me-2"></i>Create New Organization
                        </button>
                    </div>
                </div>

                <!-- System Information -->
                <div class="card shadow-sm">
                    <div class="card-header bg-transparent">
                        <h6 class="card-title mb-0">
                            <i class="fas fa-cog me-2"></i>System Information
                        </h6>
                    </div>
                    <div class="card-body">
                        {% if contact %}
                        <div class="system-info">
                            <div class="text-muted small mb-2">Created</div>
                            <div class="d-flex align-items-center mb-3">
                                <div class="avatar-xs me-2">
                                    {{ contact.created_by.first_name[0] }}{{ contact.created_by.last_name[0] }}
                                </div>
                                <div>
                                    <div>{{ contact.created_by.full_name }}</div>
                                    <div class="text-muted small">{{ contact.created_at.strftime('%B %d, %Y') }}</div>
                                </div>
                            </div>
                            <div class="text-muted small mb-2">Last Modified</div>
                            <div>{{ contact.updated_at.strftime('%B %d, %Y at %I:%M %p') }}</div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<!-- New Organization Modal -->
<div class="modal fade" id="newOrgModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Create New Organization</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="quickOrgForm">
                    <div class="mb-3">
                        <label class="form-label required">Organization Name</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Website</label>
                        <input type="url" class="form-control" name="website">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Industry</label>
                        <select class="form-select" name="industry">
                            <option value="">Select Industry</option>
                            {% for value, label in organization_industries %}
                            <option value="{{ value }}">{{ label }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" form="quickOrgForm" class="btn btn-primary">Create Organization</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block styles %}
<style>
/* Form Styling */
.form-label {
    font-size: 0.875rem;
    font-weight: 500;
    margin-bottom: 0.5rem;
}

.form-label.required::after {
    content: "*";
    color: var(--bs-danger);
    margin-left: 0.25rem;
}

.form-control, .form-select {
    font-size: 0.875rem;
    border-radius: 0.5rem;
    border: 1px solid #e0e0e0;
    padding: 0.625rem 0.875rem;
}

.form-control:focus, .form-select:focus {
    border-color: var(--bs-primary);
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.1);
}

/* Card Styling */
.card {
    border: none;
    border-radius: 0.75rem;
}

.card-header {
    background: transparent;
    border-bottom: 1px solid rgba(0,0,0,0.1);
    padding: 1rem;
}

.card-title {
    font-size: 0.875rem;
    font-weight: 600;
    margin: 0;
}

.card-subtitle {
    font-size: 0.813rem;
    font-weight: 600;
    color: var(--bs-gray-700);
}

/* Tab Styling */
.nav-tabs-modern {
    border: none;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.nav-tabs-modern .nav-link {
    border: none;
    padding: 0.75rem 1rem;
    color: var(--bs-gray-600);
    border-radius: 0.5rem;
    font-size: 0.875rem;
    font-weight: 500;
}

.nav-tabs-modern .nav-link:hover {
    background: rgba(13, 110, 253, 0.05);
    color: var(--bs-primary);
}

.nav-tabs-modern .nav-link.active {
    background: rgba(13, 110, 253, 0.1);
    color: var(--bs-primary);
}

/* Input Groups */
.input-group-text {
    background: transparent;
    border-right: none;
    padding-right: 0;
}

.input-group-text + .form-control {
    border-left: none;
    padding-left: 0.5rem;
}

/* System Info */
.avatar-xs {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--bs-primary);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.875rem;
    font-weight: 500;
}

/* Responsive */
@media (max-width: 992px) {
    .col-lg-4 {
        margin-top: 1.5rem;
    }
}
</style>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Form validation
    const form = document.getElementById('contactForm');
    form.addEventListener('submit', function(event) {
        if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
        }
        form.classList.add('was-validated');
    });

    // Quick Organization Creation
    const quickOrgForm = document.getElementById('quickOrgForm');
    quickOrgForm.addEventListener('submit', async function(event) {
        event.preventDefault();
        
        const formData = new FormData(quickOrgForm);
        try {
            const response = await fetch('/api/organizations', {
                method: 'POST',
                body: formData
            });
            
            if (response.ok) {
                const data = await response.json();
                const orgSelect = document.getElementById('organization_id');
                const option = new Option(data.name, data.id, true, true);
                orgSelect.appendChild(option);
                
                // Close modal
                bootstrap.Modal.getInstance(document.getElementById('newOrgModal')).hide();
                quickOrgForm.reset();
            }
        } catch (error) {
            console.error('Error creating organization:', error);
        }
    });
});
</script>
{% endblock %} 